{"version":3,"sources":["utils/utils.js","components/gallery/gallery.jsx","constants/constants.js","components/header/header.jsx","components/loader/loader.jsx","components/upload/upload.jsx","pages/app/app.jsx","index.jsx"],"names":["handleUrl","url","callback","img","Image","onload","newPicture","width","this","height","src","addIdToItem","item","id","Math","random","toString","substr","fileHandler","file","type","URL","createObjectURL","json","fileReader","FileReader","readAsText","evt","values","JSON","parse","target","result","key","Object","prototype","hasOwnProperty","call","map","element","push","jsonHandler","Error","Gallery","props","className","draggable","onDragOver","preventDefault","onDrop","dataTransfer","items","files","forEach","addPicture","getData","images","image","ratio","widthBase","style","flexGrow","onClick","deletePicture","alt","Header","Loader","viewBox","xmlns","fill","strokeWidth","strokeLinecap","cx","cy","r","checkUrlRegEx","RegExp","Upload","useState","isLoading","setJsonLoader","fileRef","useRef","textRef","isFileError","setFileError","onFileInputHandler","current","length","e","value","classContainer","htmlFor","disabled","ref","placeholder","textPath","test","multiple","onChange","defaultProps","App","setImages","pictures","Array","isArray","prevState","idx","findIndex","slice","ReactDOM","render","document","getElementById"],"mappings":"+XAIMA,EAAY,SAACC,EAAKC,GACtB,IAAMC,EAAM,IAAIC,MAChBD,EAAIE,OAAS,WACX,IAAMC,EAAa,CACjBL,MACAM,MAAOC,KAAKD,MACZE,OAAQD,KAAKC,QAEfP,EAASI,EAAY,QAGvBH,EAAIO,IAAMT,GAwBNU,EAAc,SAACC,GAAD,mBAAC,eAAeA,GAAhB,IAAsBC,GAFzB,WAAUC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,OAI1DC,EAAc,SAACC,EAAMjB,GACzB,OAAQiB,EAAKC,MACX,IAAK,aACL,IAAK,YACHpB,EAAUqB,IAAIC,gBAAgBH,GAAOjB,GACrC,MACF,IAAK,oBA7BW,SAACqB,EAAMrB,GACzB,IAAMsB,EAAa,IAAIC,WACvBD,EAAWE,WAAWH,EAAM,SAC5BC,EAAWnB,OAAU,SAACsB,GACpB,IAAMC,EAASC,KAAKC,MAAMH,EAAII,OAAOC,QAC/BA,EAAS,GAGf,IAAK,IAAMC,KAAOL,EACZM,OAAOC,UAAUC,eAAeC,KAAKT,EAAQK,IAC/CL,EAAOK,GAAKK,KAAI,SAACC,GAAD,OAAaP,EAAOQ,KAAKD,MAK7CrC,EAAS8B,EAAQ,SAefS,CAAYtB,EAAMjB,GAClB,MACF,QACE,MAAM,IAAIwC,QCYDC,EAzDC,SAACC,GAkCf,OACE,yBACEC,UAAU,UACVC,WAAS,EACTC,WAAY,SAACpB,GAAD,OAASA,EAAIqB,kBACzBC,OAtCe,SAACtB,GAIlB,GAHAA,EAAIqB,iBAGmC,eAAnCrB,EAAIuB,aAAaC,MAAM,GAAG/B,KAM9BO,EAAIuB,aAAaE,MAAMC,SAAQ,SAAClC,GAAD,OAAUD,EAAYC,EAAMyB,EAAMU,mBANjE,CACE,IAAMrD,EAAM0B,EAAIuB,aAAaK,QAAQ,OACrCvD,EAAUC,EAAK2C,EAAMU,eAkCpBV,EAAMY,QAAUZ,EAAMY,OAAOlB,KA5Bd,SAACmB,GACnB,IAAMC,EAAQD,EAAMlD,MAAQkD,EAAMhD,OAC5BkD,ECrBgB,IDqBJD,EAElB,OACE,yBAAKb,UAAU,gBAAgBe,MAAO,CAAEC,SAAUH,GAASzB,IAAKwB,EAAM5C,IACpE,0BAAMgC,UAAU,2BAA2BiB,QAAS,kBAAMlB,EAAMmB,cAAcN,EAAM5C,MAClF,uBAAGgC,UAAU,sBAEf,yBACEA,UAAU,oBACVtC,MAAOoD,EACPlD,OC/BgB,IDgChBC,IAAK+C,EAAMxD,IACX+D,IAAI,qEACJJ,MAAO,CAAEC,SAAU,WEvBdI,G,OARA,kBACb,yBAAKpB,UAAU,UACb,yBAAKA,UAAU,mCACb,iDCmBSqB,G,cAtBA,kBACb,yBAAKrB,UAAU,WACb,yBACEA,UAAU,oBACVtC,MAAM,OACNE,OAAO,OACP0D,QAAQ,YACRC,MAAM,8BAEN,4BACEvB,UAAU,oBACVwB,KAAK,OACLC,YAAY,IACZC,cAAc,QACdC,GAAG,KACHC,GAAG,KACHC,EAAE,WCZJC,EAAgB,IAAIC,OAAO,mBAAoB,KAE/CC,EAAS,SAACjC,GAAW,IAAD,EACWkC,oBAAS,GADpB,mBACjBC,EADiB,KACNC,EADM,KAElBC,EAAUC,mBACVC,EAAUD,mBAHQ,EAIYJ,oBAAS,GAJrB,mBAIjBM,EAJiB,KAIJC,EAJI,KAuBlBC,EAAqB,SAAC3D,GAC1BA,EAAIqB,iBACJgC,GAAc,GACd,IAAM5B,EAAQ6B,EAAQM,QAAQnC,MAAMoC,OAASP,EAAQM,QAAQnC,MAAQzB,EAAIuB,aAAaE,MAEtF,IACEiC,GAAa,GACbjC,EAAMC,SAAQ,SAAClC,GAAD,OAAUD,EAAYC,EAAMyB,EAAMU,eAChD,MAAOmC,GACPJ,GAAa,GAIfJ,EAAQM,QAAQG,MAAQ,GAGxBV,GAAc,IAGhB,OACE,0BAAMnC,UAAS,uBAAkBD,EAAM+C,iBACpCZ,GAAa,kBAAC,EAAD,MACd,yBAAKlC,UAAU,uBACb,2BAAOA,UAAU,sBAAsB+C,QAAQ,OAA/C,mGACA,yBAAK/C,UAAU,qBACb,2BACEgD,SAAUd,EACVe,IAAKX,EACLtC,UAAU,0BACVhC,GAAG,MACHO,KAAK,OACL2E,YAAY,YAEd,4BACElD,UAAU,uBACVzB,KAAK,SACL0C,QArDiB,WACzB,IAAMkC,EAAWb,EAAQI,QAAQG,MAEhB,KAAbM,IAGJhB,GAAc,GACAL,EAAcsB,KAAKD,KAG/BhG,EAAUgG,EAAUpD,EAAMU,YAC1B6B,EAAQI,QAAQG,MAAQ,IAG1BV,GAAc,KAwCNa,SAAUd,GAJZ,4DAUJ,yBAAKlC,UAAU,uBACb,2BAAOA,UAAU,sBAAsB+C,QAAQ,QAA/C,mFACA,yBACE/C,UAAU,0BACVE,WAAY,SAACpB,GAAD,OAASA,EAAIqB,kBACzBC,OAAQqC,GAER,2BACEQ,IAAKb,EACLY,SAAUd,EACVlC,UAAU,gCACVzB,KAAK,OACLP,GAAG,OACHqF,UAAQ,EACRC,SAAUb,IAEZ,yBAAKzC,UAAS,wCAAmCuC,EAAc,uCAAyC,KACtG,6BAAMA,EAAc,oHAAsC,+DAQtEP,EAAOuB,aAAe,CACpBT,eAAgB,IAQHd,QCtEAwB,G,OA/BH,WAAO,IAAD,EACYvB,mBAAS,IADrB,mBACTtB,EADS,KACD8C,EADC,KAUVhD,EAAa,SAACiD,GAElB,IAAMvE,EAASwE,MAAMC,QAAQF,GAAYA,EAASjE,IAAI3B,GAAeA,EAAY4F,GAEjFD,GAAW,SAACI,GAEV,MAAO,sBAA8BA,GAA9B1E,aAAkBwE,MAAlB,YAA4CxE,GAA5C,CAAqEA,QAIhF,OACE,yBAAKa,UAAU,OACb,kBAAC,EAAD,MACA,yBAAKA,UAAU,gCACb,kBAAC,EAAD,CAAQ8C,eAAe,oBAAoBrC,WAAYA,IACvD,kBAAC,EAAD,CAASE,OAAQA,EAAQO,cAtBT,SAAClD,GAErB,IAAM8F,EAAMnD,EAAOoD,WAAU,SAACnD,GAAD,OAAWA,EAAM5C,KAAOA,KAErDyF,GAAW,SAACI,GAAD,4BAAoBA,EAAUG,MAAM,EAAGF,IAAvC,YAAgDD,EAAUG,MAAMF,EAAM,SAkBtBrD,WAAYA,Q,OCzB3EwD,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,W","file":"static/js/main.7cc070b6.chunk.js","sourcesContent":["/*\r\n* Обработчик для ссылок\r\n* Необходим получить ширину и высоту изображения, поэтому создаем new Image\r\n* */\r\nconst handleUrl = (url, callback) => {\r\n  const img = new Image();\r\n  img.onload = function () {\r\n    const newPicture = {\r\n      url,\r\n      width: this.width,\r\n      height: this.height,\r\n    };\r\n    callback(newPicture, 'url');\r\n  };\r\n\r\n  img.src = url;\r\n};\r\n\r\nconst jsonHandler = (json, callback) => {\r\n  const fileReader = new FileReader();\r\n  fileReader.readAsText(json, 'UTF-8');\r\n  fileReader.onload = ((evt) => {\r\n    const values = JSON.parse(evt.target.result);\r\n    const result = [];\r\n\r\n    // Проходим по json файлу, чтобы не быть привязанным к ключу galleryImages\r\n    for (const key in values) {\r\n      if (Object.prototype.hasOwnProperty.call(values, key)) {\r\n        values[key].map((element) => result.push(element));\r\n      }\r\n    }\r\n\r\n    // Вызываем callback функцию для добавления Json'a\r\n    callback(result, 'json');\r\n  });\r\n};\r\n\r\nconst createID = () => `_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\nconst addIdToItem = (item) => ({ ...item, id: createID() });\r\n\r\nconst fileHandler = (file, callback) => {\r\n  switch (file.type) {\r\n    case 'image/jpeg':\r\n    case 'image/png':\r\n      handleUrl(URL.createObjectURL(file), callback);\r\n      break;\r\n    case 'application/json':\r\n      jsonHandler(file, callback);\r\n      break;\r\n    default:\r\n      throw new Error();\r\n  }\r\n};\r\n\r\nexport {\r\n  handleUrl, addIdToItem, fileHandler, jsonHandler,\r\n};\r\n","import React from 'react';\r\nimport './style/style.scss';\r\nimport PropTypes from 'prop-types';\r\nimport { handleUrl, fileHandler } from '../../utils/utils';\r\nimport BASE_IMAGE_HEIGHT from '../../constants/constants';\r\n\r\nconst Gallery = (props) => {\r\n  const handleDrop = (evt) => {\r\n    evt.preventDefault();\r\n\r\n    // Если мы делаем drag and drop уже существующего изображения (находится в галерее)\r\n    if (evt.dataTransfer.items[0].type === 'text/plain') {\r\n      const url = evt.dataTransfer.getData('URL');\r\n      handleUrl(url, props.addPicture);\r\n      return;\r\n    }\r\n\r\n    evt.dataTransfer.files.forEach((file) => fileHandler(file, props.addPicture));\r\n  };\r\n  const createImage = (image) => {\r\n    const ratio = image.width / image.height;\r\n    const widthBase = ratio * BASE_IMAGE_HEIGHT;\r\n\r\n    return (\r\n      <div className=\"gallery__item\" style={{ flexGrow: ratio }} key={image.id}>\r\n        <span className=\"gallery__item-icon-close\" onClick={() => props.deletePicture(image.id)}>\r\n          <i className=\"fas fa-trash-alt\" />\r\n        </span>\r\n        <img\r\n          className=\"gallery__item-img\"\r\n          width={widthBase}\r\n          height={BASE_IMAGE_HEIGHT}\r\n          src={image.url}\r\n          alt=\"Изображение\"\r\n          style={{ flexGrow: 1 }}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"gallery\"\r\n      draggable\r\n      onDragOver={(evt) => evt.preventDefault()}\r\n      onDrop={handleDrop}\r\n    >\r\n      {props.images && props.images.map(createImage)}\r\n    </div>\r\n  );\r\n};\r\n\r\nGallery.propTypes = {\r\n  addPicture: PropTypes.func.isRequired,\r\n  deletePicture: PropTypes.func.isRequired,\r\n  images: PropTypes.arrayOf(PropTypes.shape({\r\n    height: PropTypes.number,\r\n    id: PropTypes.string,\r\n    url: PropTypes.string,\r\n    width: PropTypes.number,\r\n  })).isRequired,\r\n};\r\n\r\nexport default Gallery;\r\n","const BASE_IMAGE_HEIGHT = 200;\r\n\r\nexport default BASE_IMAGE_HEIGHT;\r\n","import React from 'react';\r\nimport './style/style.scss';\r\n\r\nconst Header = () => (\r\n  <div className=\"header\">\r\n    <div className=\"content-wrapper header__content\">\r\n      <h1>Photo Gallery</h1>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default Header;\r\n","import React from 'react';\r\nimport './style/style.scss';\r\n\r\nconst Loader = () => (\r\n  <div className=\"spinner\">\r\n    <svg\r\n      className=\"spinner__svg-icon\"\r\n      width=\"65px\"\r\n      height=\"65px\"\r\n      viewBox=\"0 0 66 66\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <circle\r\n        className=\"spinner__svg-path\"\r\n        fill=\"none\"\r\n        strokeWidth=\"6\"\r\n        strokeLinecap=\"round\"\r\n        cx=\"33\"\r\n        cy=\"33\"\r\n        r=\"30\"\r\n      />\r\n    </svg>\r\n  </div>\r\n);\r\n\r\nexport default Loader;\r\n","import React, { useRef, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { handleUrl, fileHandler } from '../../utils/utils';\r\nimport './style/style.scss';\r\nimport Loader from '../loader/loader';\r\n\r\n// Регулярка для проверки ссылки(начинается ли с http | https)\r\nconst checkUrlRegEx = new RegExp('^(http|https)://', 'i');\r\n\r\nconst Upload = (props) => {\r\n  const [isLoading, setJsonLoader] = useState(false);\r\n  const fileRef = useRef();\r\n  const textRef = useRef();\r\n  const [isFileError, setFileError] = useState(false);\r\n\r\n  const onTextInputHandler = () => {\r\n    const textPath = textRef.current.value;\r\n\r\n    if (textPath === '') {\r\n      return;\r\n    }\r\n    setJsonLoader(true);\r\n    const match = checkUrlRegEx.test(textPath);\r\n\r\n    if (match) {\r\n      handleUrl(textPath, props.addPicture);\r\n      textRef.current.value = '';\r\n    }\r\n\r\n    setJsonLoader(false);\r\n  };\r\n\r\n  const onFileInputHandler = (evt) => {\r\n    evt.preventDefault();\r\n    setJsonLoader(true);\r\n    const files = fileRef.current.files.length ? fileRef.current.files : evt.dataTransfer.files;\r\n\r\n    try {\r\n      setFileError(false);\r\n      files.forEach((file) => fileHandler(file, props.addPicture));\r\n    } catch (e) {\r\n      setFileError(true);\r\n    }\r\n\r\n    // Убираем файл, который был в input'e, чтобы устранить дублирование при drag & drop\r\n    fileRef.current.value = '';\r\n\r\n    // Меняем статус загрузки\r\n    setJsonLoader(false);\r\n  };\r\n\r\n  return (\r\n    <form className={`upload-block ${props.classContainer}`}>\r\n      {isLoading && <Loader />}\r\n      <div className=\"upload-block__field\">\r\n        <label className=\"upload-block__label\" htmlFor=\"url\">Введите url картинки</label>\r\n        <div className=\"upload-block__url\">\r\n          <input\r\n            disabled={isLoading}\r\n            ref={textRef}\r\n            className=\"upload-block__url-input\"\r\n            id=\"url\"\r\n            type=\"text\"\r\n            placeholder=\"http://\"\r\n          />\r\n          <button\r\n            className=\"upload-block__button\"\r\n            type=\"button\"\r\n            onClick={onTextInputHandler}\r\n            disabled={isLoading}\r\n          >\r\n            Загрузить\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div className=\"upload-block__field\">\r\n        <label className=\"upload-block__label\" htmlFor=\"file\">Загрузите файл</label>\r\n        <div\r\n          className=\"upload-block__drop-area\"\r\n          onDragOver={(evt) => evt.preventDefault()}\r\n          onDrop={onFileInputHandler}\r\n        >\r\n          <input\r\n            ref={fileRef}\r\n            disabled={isLoading}\r\n            className=\"upload-block__drop-area-input\"\r\n            type=\"file\"\r\n            id=\"file\"\r\n            multiple\r\n            onChange={onFileInputHandler}\r\n          />\r\n          <div className={`upload-block__drop-area-inner ${isFileError ? 'upload-block__drop-area-inner--error' : ''}`}>\r\n            <div>{isFileError ? 'Загрузите json, png или jpeg файл' : 'Загрузить'}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nUpload.defaultProps = {\r\n  classContainer: '',\r\n};\r\n\r\nUpload.propTypes = {\r\n  classContainer: PropTypes.string,\r\n  addPicture: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Upload;\r\n","import React, { useState } from 'react';\r\nimport Gallery from '../../components/gallery/gallery';\r\nimport Header from '../../components/header/header';\r\nimport Upload from '../../components/upload/upload';\r\nimport { addIdToItem } from '../../utils/utils';\r\n\r\nimport './style/style.scss'\r\n\r\nconst App = () => {\r\n  const [images, setImages] = useState([]);\r\n\r\n  const deletePicture = (id) => {\r\n    // Получаем индекс элемента, который надо удалить\r\n    const idx = images.findIndex((image) => image.id === id);\r\n    // Получаем новый массив без элемента\r\n    setImages(((prevState) => ([...prevState.slice(0, idx), ...prevState.slice(idx + 1)])));\r\n  };\r\n\r\n  const addPicture = (pictures) => {\r\n    // Если пришел массив(json файл), то обрабатываем как массив\r\n    const result = Array.isArray(pictures) ? pictures.map(addIdToItem) : addIdToItem(pictures);\r\n\r\n    setImages(((prevState) => {\r\n      // возвращаем результат в зависимости от того, является ли result объектом или массивом\r\n      return result instanceof Array ? [...prevState, ...result] : [...prevState, result];\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      <Header />\r\n      <div className=\"content-wrapper app__content\">\r\n        <Upload classContainer=\"app__upload-block\" addPicture={addPicture} />\r\n        <Gallery images={images} deletePicture={deletePicture} addPicture={addPicture} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\nimport ReactDOM from 'react-dom';\r\nimport React from 'react';\r\nimport App from './pages/app/app';\r\n\r\nimport './style/style.scss';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}